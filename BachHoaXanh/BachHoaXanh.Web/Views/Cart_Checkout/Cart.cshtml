@model IEnumerable<BachHoaXanh.Data.ModelView.ItemCartViewWithoutLogin>

@{
    ViewBag.Title = "Cart";

    int stt = 0;
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using BachHoaXanh.Data.Models

@*<meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Grocery Store Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template,
    Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
    <script type="application/x-javascript">
        addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);
               function hideURLbar(){ window.scrollTo(0,1); } </script>

     //for-mobile-apps
    <link href="~/Content/css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
    <link href="~/Content/css/style.css" rel="stylesheet" type="text/css" media="all" />
     font-awesome icons
    <link href="~/Content/css/font-awesome.css" rel="stylesheet" type="text/css" media="all" />
     //font-awesome icons
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <p>
        <link href='//fonts.googleapis.com/css?family=Ubuntu:400,300,300italic,400italic,500,500italic,700,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>*@
<a href="~/Scripts/jquery-3.5.1.min.map"></a>
<script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
<script src="~/Content/js/jquery-1.11.1.min.js"></script>
<script src="~/Content/Admin/js/jquery-2.1.1.min.js"></script>


<script>
    paypal.minicart.render();

    paypal.minicart.cart.on('checkout', function (evt) {
        var items = this.items(),
            len = items.length,
            total = 0,
            i;

        // Count the number of each item in the cart
        for (i = 0; i < len; i++) {
            total += items[i].get('quantity');
        }

        if (total < 3) {
            alert('The minimum order quantity is 3. Please add more to your shopping cart before checking out');
            evt.preventDefault();
        }
    });

</script>


<h3>
    <em>Review</em> your cart:
</h3>
<p class="button">
    @Html.ActionLink("Address And Payment >>", "AddressAndPayment", "Cart_Checkout")
</p>
<div id="update-message"></div>
<table class="timetable_sub">
    <thead>
        <tr>
            <th>SL No.</th>
            <th>Product</th>
            <th>Quality</th>
            <th>Product Name</th>

            <th>Price</th>
            <th>Remove</th>
        </tr>
    </thead>
    <tbody>
        @if (Model != null)
        {
            foreach (var item in Model)
            {
                if (item.Status == 1)
                {
                    stt += 1;
                    <tr class="rem" data-id="@item.ProductId">
                        <td class="invert">@stt</td>
                        <td class="invert-image"><a href="@Url.Action("Details", "Products", new { id = item.ProductId })"><img src="@Url.Content(item.Image)" class="img-responsive"></a></td>
                        <td class="invert">
                            <div class="quantity">
                                <div class="quantity-select">
                                    <div class="entry value-minus" data-id="@item.ProductId">&nbsp;</div>
                                    <div class="entry value"><span>@item.Amount</span></div>
                                    <div class="entry value-plus active" data-id="@item.ProductId">&nbsp;</div>
                                </div>
                            </div>
                        </td>
                        <td class="invert">@item.ProductName<a href="@Url.Action("Details", "Products", new { id = item.ProductId })"></a></td>

                        <td class="invert" id="ItemTotal">@item.Total</td>
                        <td class="invert">
                            <div class="rem">
                                <div class="close" data-id="@item.ProductId"><img src="@Url.Content("~/Images/close.jpg")" class="img-responsive" @*class="RemoveLink" data-id="@item.ProductId"*@></div>
                            </div>
                        </td>
                    </tr>

                }
            }
        }

        <tr>
            <td colspan=" 4" style=" text-align: right">
                <h3>Total</h3>
            </td>
            <td id="CartTotal" style=" text-align:right">
                <h3>@ViewBag.CartTotal</h3>
            </td>
        </tr>
    </tbody>
</table>





<script src="~/Content/js/jquery-1.11.1.min.js"></script>
<!--quantity-->
<script>
    $('.value-plus').on('click', function () {
        var divUpd = $(this).parent().find('.value'), newVal = parseInt(divUpd.text(), 10) + 1;
        var itemId = $(this).attr("data-id");
        //var itemTotal = $(this).find('#ItemTotal'), itemVal = parseFloat(itemTotal.text(), 10) * newVal;
        //var cartTotal = $(this).find('#CartTotal'), cartVal = parseFloat(cartTotal.text(), 10) + itemTotal;
        $.ajax({
            //async: true,
            type: 'POST',
             // contentType: false,
             // processData: false,
            data: { "id": itemId},
            url: '@Url.Content("AddToCart")',
            success: function (data) {

                divUpd.text(newVal);
                $('#ItemTotal').html(@ViewBag.ItemTotal);
                $('#CartTotal').html(@ViewBag.CartTotal);
            },
            error: function (data) {
                alert("There is some problem");

            }
        });
    });
</script>

<script>
    $('.value-minus').on('click', function () {
        var divUpd = $(this).parent().find('.value'), newVal = parseInt(divUpd.text(), 10) - 1;
        var itemId = $(this).attr("data-id");
        var itemTotal = $(this).find('#ItemTotal'), itemVal = parseFloat(itemTotal.text(), 10) * newVal;
        var cartTotal = $(this).find('#CartTotal'), cartVal = parseFloat(cartTotal.text(), 10) + itemTotal;
        $.ajax({
            //async: true,
            type: 'POST',
            //  contentType: false,
            //  processData: false,
            data: { "id": itemId, "amount": newVal },
            url: '@Url.Content("RemoveAmountOfCartItem")',
            success: function (data) {
                if (newVal >= 1) {
                    divUpd.text(newVal);
                    $('#CartTotal').text(cartVal);
                }
            },
            error: function (data) {
                alert("There is some problem");

            }
        });

    });
</script>


quantity
<script>
        $(document).ready(function (c) {
            $('.close').on('click', function (c) {
                var itemId = $(this).attr("data-id");

                $.ajax({
                  //  async: true,
                    type: 'POST',
                    //  contentType: false,
                   //  processData: false,
                    data: { "pid": itemId },
                    url: '@Url.Content("RemoveCartItem")',
                    success: function (data) {
                        $('#rem-' + itemId).fadeOut('quick', function (c) {
                            $('#rem-' + itemId).remove();
                        })
                    },
                    error: function (data) {
                        alert("There is some problem");
                    }
                });
            });
        });
    </script>


@*<script type="text/javascript">
    $(function () {
        // Document.ready -> link up remove event handler
        $('.close').click(function () {
            // Get the id from the link
            var recordToDelete = $(this).attr("data-id");
            if (recordToDelete != '') {
                // Perform the ajax post
                $.post("/RemoveCartItem", { "pid": recordToDelete },
                    function (data) {
                        // Successful requests get here
                        // Update the page elements
                        //if (data.) {
                        $('#row-' + recordToDelete).fadeOut('slow');
                        //    } else {
                        //        $('#item-count-' + data.DeleteId).text(data.ItemCount);
                        //    }
                        //    $('#cart-total').text(data.CartTotal);
                        //    $('#update-message').text(data.Message);
                        //    $('#cart-status').text('Cart (' + data.CartCount + ')');
                        //});
                    });
        }
    });
</script>*@

<!-- //js -->
<!-- script-for sticky-nav -->
<script>
    $(document).ready(function () {
        var navoffeset = $(".agileits_header").offset().top;
        $(window).scroll(function () {
            var scrollpos = $(window).scrollTop();
            if (scrollpos >= navoffeset) {
                $(".agileits_header").addClass("fixed");
            } else {
                $(".agileits_header").removeClass("fixed");
            }
        });

    });
</script>
<!-- //script-for sticky-nav -->
<!-- start-smoth-scrolling -->
<script type="text/javascript" src="~/Content/js/move-top.js"></script>js/move-top.js"></script>
<script type="text/javascript" src="~/Contentjs/easing.js"></script>
<script type="text/javascript">
    jQuery(document).ready(function ($) {
        $(".scroll").click(function (event) {
            event.preventDefault();
            $('html,body').animate({ scrollTop: $(this.hash).offset().top }, 1000);
        });
    });
</script>
<!-- start-smoth-scrolling -->
<!-- Bootstrap Core JavaScript -->
<script src="~/Content/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        $(".dropdown").hover(
            function () {
                $('.dropdown-menu', this).stop(true, true).slideDown("fast");
                $(this).toggleClass('open');
            },
            function () {
                $('.dropdown-menu', this).stop(true, true).slideUp("fast");
                $(this).toggleClass('open');
            }
        );
    });
</script>
<!-- here stars scrolling icon -->
<script type="text/javascript">
    $(document).ready(function () {
        /*
            var defaults = {
            containerID: 'toTop', // fading element id
            containerHoverID: 'toTopHover', // fading element hover id
            scrollSpeed: 1200,
            easingType: 'linear'
            };
        */

        $().UItoTop({ easingType: 'easeOutQuart' });

    });
</script>
<!-- //here ends scrolling icon -->
<script src="~/Content/js/minicart.js"></script>
<script>
    paypal.minicart.render();

    paypal.minicart.cart.on('checkout', function (evt) {
        var items = this.items(),
            len = items.length,
            total = 0,
            i;

        // Count the number of each item in the cart
        for (i = 0; i < len; i++) {
            total += items[i].get('quantity');
        }

        if (total < 3) {
            alert('The minimum order quantity is 3. Please add more to your shopping cart before checking out');
            evt.preventDefault();
        }
    });

</script>



